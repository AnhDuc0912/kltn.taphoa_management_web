# app.py
import os
from flask import Flask
from search_routes import bp as search_bp  # nếu bạn đang dùng

# --- App & cấu hình chung ---
app = Flask(__name__)
app.secret_key = os.getenv("SECRET_KEY", "dev-secret")

UPLOAD_DIR = os.path.abspath(os.getenv("UPLOAD_FOLDER", "uploads"))
os.makedirs(UPLOAD_DIR, exist_ok=True)
app.config["UPLOAD_DIR"] = UPLOAD_DIR

# --- Đăng ký các blueprint (routes đã tách) ---
from routes.dashboard import bp as dashboard_bp
from routes.uploads import bp as uploads_bp
from routes.brands import bp as brands_bp
from routes.categories import bp as categories_bp
from routes.skus import bp as skus_bp
from routes.sku_texts import bp as sku_texts_bp
from routes.sku_images import bp as sku_images_bp
from routes.import_csv import bp as import_bp
from routes.captions import bp as captions_bp
from routes.admin import bp as admin_bp

app.register_blueprint(search_bp)      # blueprint hiện có
app.register_blueprint(dashboard_bp)
app.register_blueprint(uploads_bp)
app.register_blueprint(brands_bp)
app.register_blueprint(categories_bp)
app.register_blueprint(skus_bp)
app.register_blueprint(sku_texts_bp)
app.register_blueprint(sku_images_bp)
app.register_blueprint(import_bp)
app.register_blueprint(captions_bp)
app.register_blueprint(admin_bp)

# factory compat (nếu cần)
def create_app():
    return app

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.getenv("PORT", "5000")))
