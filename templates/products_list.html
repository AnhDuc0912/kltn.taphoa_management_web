{% extends "base.html" %}
{% block title %}Danh sách sản phẩm{% endblock %}
{% block content %}
<h3>Danh sách sản phẩm</h3>
<form class="row g-2 mb-3">
  <div class="col-sm-4">
    <input class="form-control" name="q" placeholder="Từ khóa (tên/mô tả)" value="{{ q }}">
  </div>
  <div class="col-sm-3">
    <select class="form-select" name="category">
      <option value="">-- Danh mục --</option>
      {% for c in categories %}
      <option value="{{c}}" {% if category==c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-3">
    <select class="form-select" name="brand">
      <option value="">-- Thương hiệu --</option>
      {% for b in brands %}
      <option value="{{b}}" {% if brand==b %}selected{% endif %}>{{ b }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-2">
    <button class="btn btn-primary w-100">Lọc</button>
  </div>
</form>

<div class="row row-cols-1 row-cols-md-3 g-3">
  {% for p in items %}
  <div class="col">
    <div class="card h-100 shadow-sm">
      {% if p.image_url %}
      <img src="{{ p.image_url }}" class="card-img-top" style="object-fit:cover;height:180px;">
      {% endif %}
      <div class="card-body">
        <h6 class="card-title">{{ p.name }}</h6>
        <div class="small text-muted">{{ p.brand or "N/A" }} · {{ p.category or "N/A" }}</div>
        <div class="mt-2 fw-bold">{{ "{:,.0f}".format(p.price or 0) }} đ</div>
      </div>
      <div class="card-footer d-flex gap-2">
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit_product', pid=p.id) }}">Sửa</a>
        <form method="post" action="{{ url_for('delete_product', pid=p.id) }}" onsubmit="return confirm('Xóa sản phẩm?')">
          <button class="btn btn-sm btn-outline-danger">Xóa</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<nav class="mt-3">
  <ul class="pagination">
    {% for i in range(1, pages+1) %}
    <li class="page-item {% if i==page %}active{% endif %}">
      <a class="page-link" href="?page={{i}}&q={{q}}&category={{category}}&brand={{brand}}">{{ i }}</a>
    </li>
    {% endfor %}
  </ul>
</nav>
{% endblock %}
