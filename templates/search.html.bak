{% extends "base.html" %}
{% block title %}Tìm kiếm vector{% endblock %}
{% block content %}
<h3>Tìm kiếm vector</h3>
<form method="post" enctype="multipart/form-data" class="row g-3 mb-3">
  <div class="col-md-2">
    <label class="form-label">Chế độ</label>
    <select name="mode" class="form-select">
      <option value="image" {% if mode=='image' %}selected{% endif %}>Theo ảnh</option>
      <option value="text" {% if mode=='text' %}selected{% endif %}>Theo chú thích</option>
    </select>
  </div>
  <div class="col-md-4" {% if mode != 'image' %}style="display:none"{% endif %} id="uploadRow">
    <label class="form-label">Ảnh truy vấn</label>
    <input type="file" name="image" class="form-control">
  </div>
  <div class="col-md-6" {% if mode != 'text' %}style="display:none"{% endif %} id="textRow">
    <label class="form-label">Văn bản truy vấn</label>
    <input name="query_text" class="form-control" value="{{ query_text }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">Kết quả K</label>
    <input type="number" name="k" class="form-control" value="{{ k }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">Giá min</label>
    <input type="number" name="min_price" class="form-control" value="{{ min_price }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">Giá max</label>
    <input type="number" name="max_price" class="form-control" value="{{ max_price }}">
  </div>
  <div class="col-md-2 align-self-end">
    <button class="btn btn-primary w-100">Tìm</button>
  </div>
</form>

<div class="row row-cols-1 row-cols-md-3 g-3">
  {% for r in results %}
  <div class="col">
    <div class="card h-100 shadow-sm">
      {% if r.image_url %}
      <img src="{{ r.image_url }}" class="card-img-top" style="object-fit:cover;height:180px;">
      {% endif %}
      <div class="card-body">
        <h6 class="card-title">{{ r.name }}</h6>
        <div class="small text-muted"></div>
        <div class="mt-2 fw-bold">{{ "{:,.0f}".format(r.price or 0) }} đ</div>
        <div class="small">distance: {{ '%.4f'|format(r.distance or 0) }}</div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<script>
const modeSel = document.querySelector('select[name="mode"]');
const uploadRow = document.getElementById('uploadRow');
const textRow = document.getElementById('textRow');
modeSel.addEventListener('change', () => {
  const m = modeSel.value;
  uploadRow.style.display = (m === 'image') ? '' : 'none';
  textRow.style.display = (m === 'text') ? '' : 'none';
});
</script>
{% endblock %}
